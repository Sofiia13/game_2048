var e;const t=new((e=class{constructor(e){console.log(e),this.isGameOver=!1,this.score=0,this.hasMovedOnce=!1}moveLeft(){if(this.isGameOver)return;let e=this.getState();return document.querySelector("tbody").querySelectorAll("tr").forEach(e=>{let t=Array.from(e.querySelectorAll("td"));this.processLine(t)}),this.afterMoveActions(e),this.score}moveRight(){if(this.isGameOver)return;let e=this.getState();return document.querySelector("tbody").querySelectorAll("tr").forEach(e=>{let t=Array.from(e.querySelectorAll("td"));t=t.reverse(),this.processLine(t)}),this.afterMoveActions(e),this.score}moveUp(){if(this.isGameOver)return;let e=this.getState(),t=document.querySelector("tbody").querySelectorAll("tr"),r=t[0].querySelectorAll("td").length;for(let e=0;e<r;e++){let r=[];t.forEach(t=>{r.push(t.querySelectorAll("td")[e])}),this.processLine(r)}return this.afterMoveActions(e),this.score}moveDown(){if(this.isGameOver)return;let e=this.getState(),t=document.querySelector("tbody").querySelectorAll("tr"),r=t[0].querySelectorAll("td").length;for(let e=0;e<r;e++){let r=[];t.forEach(t=>{r.push(t.querySelectorAll("td")[e])}),r.reverse(),this.processLine(r)}return this.afterMoveActions(e),this.score}getScore(){document.querySelector(".game-score").textContent=this.score}getState(){let e=[];return document.querySelectorAll("tbody tr").forEach(t=>{let r=[];t.querySelectorAll("td").forEach(e=>{let t=parseInt(e.textContent.trim());r.push(isNaN(t)?0:t)}),e.push(r)}),e}getStatus(){let e=this.getState(),t=e.some(e=>e.includes(0)),r=e.some(e=>e.includes(2048));return t||this.canMerge(e)?r?(this.isGameOver=!0,document.querySelector(".message-win").classList.remove("hidden"),"win"):"playing":(this.isGameOver=!0,document.querySelector(".message-lose").classList.remove("hidden"),"lose")}start(){this.isGameOver=!1,document.querySelector(".message-start").classList.add("hidden");let e=0;this.getState().forEach(t=>{t.forEach(t=>{0!==t&&e++})});for(let t=0;t<2-e;t++)this.generateCube();this.getScore()}restart(){this.isGameOver=!1,this.hasMovedOnce=!1;let e=document.querySelector(".button");e.classList.remove("restart"),e.classList.add("start"),e.textContent="Start",document.querySelector(".message-start").classList.remove("hidden"),document.querySelector(".message-lose").classList.add("hidden"),document.querySelector(".message-win").classList.add("hidden"),this.score=0,document.querySelectorAll("tbody tr").forEach(e=>{e.querySelectorAll("td").forEach(e=>{e.textContent="",e.classList.forEach(t=>{t.startsWith("field-cell--")&&e.classList.remove(t)})})}),this.getScore()}extractValues(e){let t=[];return e.forEach(e=>{let r=e.textContent.trim();""!==r&&t.push(r)}),t}updateCells(e,t){e.forEach((e,r)=>{e.classList.forEach(t=>{t.startsWith("field-cell--")&&e.classList.remove(t)}),t[r]?(e.classList.add(`field-cell--${t[r]}`),e.textContent=t[r]):e.textContent=""})}processLine(e){let t=this.extractValues(e);this.mergeCubes(t),this.updateCells(e,t)}afterMoveActions(e){let t=this.getState();this.areStatesEqual(e,t)||(this.generateCube(),this.getStatus(),this.markFirstMove())}mergeCubes(e){for(let t=0;t<e.length;t++)e[t]===e[t+1]&&(e[t]*=2,this.score+=e[t],e.splice(t+1,1));return e}generateCube(){let e=document.querySelector("tbody").querySelectorAll("tr"),t=Math.floor(Math.random()*e.length),r=e[t].querySelectorAll("td"),s=Math.floor(Math.random()*r.length),o=r[s];if(""!==o.textContent.trim()){this.generateCube();return}let l=.9>Math.random()?2:4;o.classList.add(`field-cell--${l}`),o.textContent=l}canMerge(e){for(let t=0;t<4;t++)for(let r=0;r<4;r++){let s=e[t][r];if(r<3&&s===e[t][r+1]||t<3&&s===e[t+1][r])return!0}return!1}areStatesEqual(e,t){for(let r=0;r<e.length;r++)for(let s=0;s<e[r].length;s++)if(e[r][s]!==t[r][s])return!1;return!0}markFirstMove(){if(!this.hasMovedOnce){let e=document.querySelector(".button");e.classList.remove("start"),e.classList.add("restart"),e.textContent="Restart",this.hasMovedOnce=!0}}}).__esModule?e.default:e),r=document.querySelector(".button");r.addEventListener("click",()=>{r.classList.contains("start")?t.start():r.classList.contains("restart")&&t.restart()}),document.addEventListener("keydown",e=>{switch(e.key){case"ArrowLeft":t.moveLeft(),t.getScore();break;case"ArrowRight":t.moveRight(),t.getScore();break;case"ArrowUp":t.moveUp(),t.getScore();break;case"ArrowDown":t.moveDown(),t.getScore()}});
//# sourceMappingURL=index.1dcfaaf0.js.map
